<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Chat and Talk</title>
    <link href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css" rel="stylesheet" />
    <link href="https://fonts.googleapis.com/css2?family=Ubuntu&display=swap" />
    <link rel="stylesheet" type="text/css" href="layout.css" />
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>
  </head>



  <body>
    <h1 id="roomName">聊天室</h1>
    <div class="container-fluid">
      <div class="row">
        <div class="col-8">
          <table id="Msg" class="col-8">
            <tbody><tr class="otherMsg"><td class="author">b</td><td class="message">http://photos.smugmug.com/photos/invalid344291068_HdnTo-Ti.jpg</td><td class="time">16:30:29</td></tr></tbody><tr class="otherMsg"><td class="author">b</td><td class="message">https://www.google.com/images/srpr/logo3w.png</td><td class="time">16:30:23</td></tr><tr class="myMsg"><td class="author">a</td><td class="message">https://www.google.com/images/srpr/logo3w.png</td><td class="time">15:57:15</td></tr><tr class="otherMsg"><td class="author">b</td><td class="message">d</td><td class="time">15:57:10</td></tr><tr class="otherMsg"><td class="author">b</td><td class="message">d</td><td class="time">15:57:09</td></tr><tr class="otherMsg"><td class="author">b</td><td class="message">d</td><td class="time">15:57:09</td></tr><tr class="otherMsg"><td class="author">b</td><td class="message">dd</td><td class="time">15:57:09</td></tr><tr class="otherMsg"><td class="author">b</td><td class="message">asdddd</td><td class="time">15:57:08</td></tr><tr class="myMsg"><td class="author">a</td><td class="message">https://www.google.com/images/srpr/logo3w.png</td><td class="time">15:56:25</td></tr><tr class="myMsg"><td class="author">a</td><td class="message">https://www.google.com/images/srpr/logo3w.png</td><td class="time">15:51:18</td></tr><tr class="otherMsg"><td class="author">b</td><td class="message">asd</td><td class="time">15:51:07</td></tr><tr class="myMsg"><td class="author">a</td><td class="message">sadad</td><td class="time">15:50:58</td></tr><tr class="myMsg"><td class="author">a</td><td class="message">https://www.google.com/images/srpr/logo3w.png</td><td class="time">15:46:47</td></tr><tr class="myMsg"><td class="author">a</td><td class="message">https://www.google.com/images/srpr/logo3w.png</td><td class="time">15:41:19</td></tr><tr class="myMsg"><td class="author">a</td><td class="message">http://photos.smugmug.com/photos/invalid344291068_HdnTo-Ti.jpg</td><td class="time">15:40:32</td></tr><tr class="myMsg"><td class="author">a</td><td class="message">http://www.cnn.com/foo1.jpg</td><td class="time">15:39:56</td></tr><tr class="myMsg"><td class="author">a</td><td class="message">http://photos.smugmug.com/photos/344291068_HdnTo-Ti.jpg</td><td class="time">15:39:36</td></tr><tr class="myMsg"><td class="author">a</td><td class="message">dasd</td><td class="time">15:39:35</td></tr><tr class="myMsg"><td class="author">a</td><td class="message">http://photos.smugmug.com/photos/344291068_HdnTo-Ti.jpg</td><td class="time">15:34:44</td></tr><tr class="myMsg"><td class="author">a</td><td class="message">aa</td><td class="time">15:34:42</td></tr><tr class="otherMsg"><td class="author">undefined</td><td class="message">undefined</td><td class="time">undefined</td></tr><tr class="otherMsg"><td class="author">undefined</td><td class="message">undefined</td><td class="time">undefined</td></tr><tr class="otherMsg"><td class="author">undefined</td><td class="message">undefined</td><td class="time">undefined</td></tr><tr class="otherMsg"><td class="author">undefined</td><td class="message">undefined</td><td class="time">undefined</td></tr><tr class="otherMsg"><td class="author">undefined</td><td class="message">undefined</td><td class="time">undefined</td></tr><tr class="otherMsg"><td class="author">undefined</td><td class="message">undefined</td><td class="time">undefined</td></tr><tr class="otherMsg"><td class="author">undefined</td><td class="message">undefined</td><td class="time">undefined</td></tr><tr class="otherMsg"><td class="author">undefined</td><td class="message">undefined</td><td class="time">undefined</td></tr><tr class="otherMsg"><td class="author">undefined</td><td class="message">undefined</td><td class="time">undefined</td></tr><tr class="myMsg"><td class="author">a</td><td class="message">http://photos.smugmug.com/photos/344291068_HdnTo-Ti.jpg</td><td class="time">15:21:24</td></tr><tr class="myMsg"><td class="author">a</td><td class="message">http://photos.smugmug.com/photos/344291068_HdnTo-Ti.jpg</td><td class="time">15:21:23</td></tr><tr class="myMsg"><td class="author">a</td><td class="message">http://photos.smugmug.com/photos/344291068_HdnTo-Ti.jpg</td><td class="time">15:21:22</td></tr><tr class="myMsg"><td class="author">a</td><td class="message">http://photos.smugmug.com/photos/344291068_HdnTo-Ti.jpg</td><td class="time">15:21:18</td></tr><tr class="myMsg"><td class="author">a</td><td class="message">a</td><td class="time">15:21:02</td></tr><tr class="myMsg"><td class="author">a</td><td class="message">a</td><td class="time">15:21:02</td></tr><tr class="myMsg"><td class="author">a</td><td class="message">a</td><td class="time">15:21:01</td></tr><tr class="myMsg"><td class="author">a</td><td class="message">a</td><td class="time">00:36:26</td></tr><tr class="otherMsg"><td class="author">b</td><td class="message">asdanosidn</td><td class="time">00:26:46</td></tr><tr class="otherMsg"><td class="author">b</td><td class="message">a</td><td class="time">00:26:44</td></tr><tr class="otherMsg"><td class="author">b</td><td class="message">a</td><td class="time">00:26:44</td></tr><tr class="otherMsg"><td class="author">b</td><td class="message">a</td><td class="time">00:26:43</td></tr><tr class="otherMsg"><td class="author">b</td><td class="message">a</td><td class="time">00:26:43</td></tr><tr class="otherMsg"><td class="author">b</td><td class="message">a</td><td class="time">00:26:43</td></tr><tr class="otherMsg"><td class="author">b</td><td class="message">a</td><td class="time">00:26:43</td></tr><tr class="otherMsg"><td class="author">b</td><td class="message">a</td><td class="time">00:26:42</td></tr><tr class="otherMsg"><td class="author">b</td><td class="message">a</td><td class="time">00:26:40</td></tr><tr class="otherMsg"><td class="author">b</td><td class="message">a</td><td class="time">00:26:39</td></tr><tr class="otherMsg"><td class="author">b</td><td class="message">a</td><td class="time">00:26:39</td></tr><tr class="otherMsg"><td class="author">b</td><td class="message">a</td><td class="time">00:26:39</td></tr><tr class="otherMsg"><td class="author">b</td><td class="message">a</td><td class="time">00:26:38</td></tr><tr class="otherMsg"><td class="author">b</td><td class="message">a</td><td class="time">00:26:38</td></tr><tr class="otherMsg"><td class="author">b</td><td class="message">a</td><td class="time">00:26:38</td></tr><tr class="otherMsg"><td class="author">b</td><td class="message">a</td><td class="time">00:26:37</td></tr><tr class="myMsg"><td class="author">a</td><td class="message">a</td><td class="time">00:26:33</td></tr><tr class="myMsg"><td class="author">a</td><td class="message">a</td><td class="time">00:26:33</td></tr><tr class="myMsg"><td class="author">a</td><td class="message">a</td><td class="time">00:26:33</td></tr><tr class="myMsg"><td class="author">a</td><td class="message">a</td><td class="time">00:26:33</td></tr><tr class="myMsg"><td class="author">a</td><td class="message">d</td><td class="time">16:26:19</td></tr><tr class="otherMsg"><td class="author">b</td><td class="message">asdad</td><td class="time">16:26:15</td></tr><tr class="myMsg"><td class="author">a</td><td class="message">a</td><td class="time">14:15:27</td></tr>
          </table>
        </div>
        <div class="col-4">
          <h1 style="color:grey">圖片<h1>
          <img id="image" src="https://upload.cc/i1/2019/09/30/L5KTDW.png" >
        </div>
      </div>
    </div>
    <form>
      <input type="text" id="msg" placeholder="輸入訊息" style="border-color:black;border-width:3px;border-style:solid;" />
      <input type="submit" id="submitButton" value="Send" />
    </form>
  </body>


  <script src="/socket.io/socket.io.js"></script>
  <script
    src="https://code.jquery.com/jquery-3.5.1.js"
    integrity="sha256-QWo7LDvxbWT2tbbQ97B53yJnYU3WhH/C8ycbRAkjPDc="
    crossorigin="anonymous"
  ></script>
  <script>
    let userName = prompt("Username");
    let roomName = prompt("Room name");
    let socket = io();
    
    document.getElementById("roomName").innerText = roomName

    // send event that user has joined room
    socket.emit("join", {userName: userName, roomName: roomName});

    // focus on text box
    document.getElementById("msg").focus();

    // submit
    document
      .getElementsByTagName("form")[0]
      .addEventListener("submit", function (event) {
        event.preventDefault();
        socket.emit("send message", {
          author: userName,
          room: roomName,
          message: document.getElementById("msg").value
        });

        document.getElementById("msg").value = "";
        document.getElementById("msg").focus();
      });

    // show get new message
    socket.on("show message", (data)=>{
      const tr = document.createElement("tr");
      const Atd = document.createElement("td");
      const Mtd = document.createElement("td");
      const Ttd = document.createElement("td");
      let authorClass = "";
      let divClass = "";

      // verify that who send the message
      if (data.author === userName) {
        divClass = "myMsg";
      } else {
        divClass = "otherMsg";
      }

      tr.className = divClass;
      Atd.className = "author";
      Mtd.className = "message";
      Ttd.className = "time";

      Atd.innerText = data.author;
      Mtd.innerText = data.message;
      Ttd.innerText = data.time;
      
      tr.appendChild(Atd);
      tr.appendChild(Mtd);
      tr.appendChild(Ttd);

      var first = document.getElementById("Msg").firstChild;
      document.getElementById("Msg").insertBefore(tr,first);
      
      // Show image
      image = document.getElementById("image");
      if (data.image != null) {
        image.src = data.image;
      }
    });

    // remove message
    socket.on("hide message", (data)=>{
      document.getElementById(data.id).remove();
    });

    function checkURL(url) {
      return(url.match(/\.(jpeg|jpg|gif|png)$/) != null);
    }
  </script>
</html>